{
  "comments": [
    "Tests covering the use of KAFKA_TOPIC in the WITH clause."
  ],
  "tests": [
    {
      "name": "explicit - missing",
      "statements": [
        "CREATE STREAM INPUT (VAL STRING);"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON",
        "ksql.persistence.source.topic.naming.strategy": "io.confluent.ksql.naming.ExplicitSourceTopicNamingStrategy"
      },
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "Explicit 'KAFKA_TOPIC' required in the WITH clause"
      }
    },
    {
      "name": "explicit - provided",
      "statements": [
        "CREATE STREAM INPUT (VAL STRING) WITH (kafka_topic='INPUT');",
        "CREATE STREAM OUTPUT AS SELECT * FROM INPUT;"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON"
      },
      "inputs": [
        {"topic": "INPUT", "value": {"VAL": "v"}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "value": {"VAL": "v"}}
      ]
    },
    {
      "name": "default (case-insensitive) - unquoted - match",
      "statements": [
        "CREATE STREAM INPUT (VAL STRING);",
        "CREATE STREAM OUTPUT AS SELECT * FROM INPUT;"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON"
      },
      "inputs": [
        {"topic": "Input", "value": {"VAL": "v"}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "value": {"VAL": "v"}}
      ]
    },
    {
      "name": "default (case-insensitive) - unquoted - no match",
      "statements": [
        "CREATE STREAM INPUT (VAL STRING);"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON"
      },
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "No existing topic named `INPUT` (case-insensitive)"
      }
    },
    {
      "name": "default (case-insensitive) - quoted - match",
      "statements": [
        "CREATE STREAM `InPut` (VAL STRING);",
        "CREATE STREAM OUTPUT AS SELECT * FROM `InPut`;"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON"
      },
      "inputs": [
        {"topic": "Input", "value": {"VAL": "v"}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "value": {"VAL": "v"}}
      ]
    },
    {
      "name": "default (case-insensitive) - quoted - no match",
      "statements": [
        "CREATE STREAM `InPut` (VAL STRING);"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON"
      },
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "No existing topic named `InPut` (case-insensitive)"
      }
    },
    {
      "name": "case-sensitive - unquoted - match",
      "statements": [
        "CREATE STREAM InPuT (VAL STRING);",
        "CREATE STREAM OUTPUT AS SELECT * FROM INPUT;"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON",
        "ksql.persistence.source.topic.naming.strategy": "io.confluent.ksql.naming.CaseSensitiveSourceTopicNamingStrategy"
      },
      "inputs": [
        {"topic": "INPUT", "value": {"VAL": "v"}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "value": {"VAL": "v"}}
      ]
    },
    {
      "name": "case-sensitive - unquoted- no match",
      "statements": [
        "CREATE STREAM InPuT (VAL STRING);"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON",
        "ksql.persistence.source.topic.naming.strategy": "io.confluent.ksql.naming.CaseSensitiveSourceTopicNamingStrategy"
      },
      "topics": [
        {"name": "InPuT"}
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "No existing topic named `INPUT` (case-sensitive)"
      }
    },
    {
      "name": "case-sensitive - quoted - match",
      "statements": [
        "CREATE STREAM `InPuT` (VAL STRING);",
        "CREATE STREAM OUTPUT AS SELECT * FROM `InPuT`;"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON",
        "ksql.persistence.source.topic.naming.strategy": "io.confluent.ksql.naming.CaseSensitiveSourceTopicNamingStrategy"
      },
      "inputs": [
        {"topic": "InPuT", "value": {"VAL": "v"}}
      ],
      "outputs": [
        {"topic": "OUTPUT", "value": {"VAL": "v"}}
      ]
    },
    {
      "name": "case-sensitive - quoted- no match",
      "statements": [
        "CREATE STREAM `InPuT` (VAL STRING);"
      ],
      "properties": {
        "ksql.persistence.default.format.value": "JSON",
        "ksql.persistence.source.topic.naming.strategy": "io.confluent.ksql.naming.CaseSensitiveSourceTopicNamingStrategy"
      },
      "topics": [
        {"name": "INPUT"}
      ],
      "expectedException": {
        "type": "io.confluent.ksql.util.KsqlStatementException",
        "message": "No existing topic named `InPuT` (case-sensitive)"
      }
    }
  ]
}